%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Define Article %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Using Packages %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{geometry}
\usepackage{amsmath}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{pythontex}
\usepackage{booktabs}
\usepackage{caption}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% other settings %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareMathOperator{\E}{\mathbb{E}}
\setlength{\parindent}{1em}
\setlength{\parskip}{1em}
\renewcommand{\baselinestretch}{1.15}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Page Setting %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\geometry{
    a4paper,
    total={170mm,257mm},
    left=20mm,
    top=20mm,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Py settings  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{pycode}
    import pandas as pd
    from pathlib import Path, PurePath
    import os

    os.chdir(Path.cwd().parent)

    import z_ns as ns

    cte = ns.Constants()
    td = ns.TexDataFilenames()
    dirs = ns.Dirs()


    texDtDir = dirs.texdata
    varfn = td.vars
    varpn = texDtDir / f"{varfn}.csv"
    vpn = PurePath(varpn)

    vars = pd.read_csv(varpn, index_col = 0, )

    valc = cte.val
    bslbl = cte.Balanced
    wslbl = cte.Whole

\end{pycode}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Title & Author %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{TSE Monthly Sale Project \\ A Brief Report}
\author{Mahdi Mir}
\date{}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Document beginning %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
    \maketitle
    \date
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    \section{Files and Folders}

    In the folder delivered, there is the current report and three folders named: `Code', `data', and `figs'.

    \subsection{Code}
    In the code folder, we have all the codes for the project. These codes essentially extract monthly data from `codal.ir' each time they are executed.
    The code extracts all monthly sales data from the beginning of monthly sale reports to the latest available monthly sale statement.

    \subsection{data}
    The extracted monthly sale data is in the data folder. Moreover there are bunch of other output datasets which are deducted from the sale data and some analysis about it.

    \subsection{figs}
    In this folder, all the following charts are available as quality '.eps' files.


    \section{Data Description}

    \begin{pycode}
        sumstat_fn = td.sumStat
        stc = ns.SumStatCols()
        stat = pd.read_csv(vpn.with_stem(sumstat_fn), index_col=0)
    \end{pycode}

    In the following table, I present summary some descriptive numbers about the data and its balanced subsample. The balanced subsample starts from \py{stat.loc[bslbl,stc.initJMonth]} until the latest month.
    Whole sample consist of only two type of firms: production and service.

    \begin{table}
        \small \setlength{\tabcolsep}{4pt}
        \captionsetup{font=large}
        \caption{Datasets Description}

        \begin{center}
            \begin{tabular}{lcc}
                \toprule
                & Whole Sample                                        & The Balanced Subsample-\py{stat.loc[bslbl,stc.initJMonth]} \\
                \midrule
                Observations              & \py{stat.loc[wslbl,stc.obs]}                        & \py{stat.loc[bslbl,stc.obs]}                               \\
                Initial Month             & \py{stat.loc[wslbl,stc.initJMonth]}                 & \py{stat.loc[bslbl,stc.initJMonth]}                        \\
                Last Month                & \py{stat.loc[wslbl,stc.lastJMonth]}                 & \py{stat.loc[bslbl,stc.lastJMonth]}                        \\
                Months Count              & \py{stat.loc[wslbl,stc.monthsNo]}                   & \py{stat.loc[bslbl,stc.monthsNo]}                          \\
                Mean Observations Monthly & \py{round(stat.loc[wslbl,stc.avgObsMonthly],1)}     & \py{stat.loc[bslbl,stc.avgObsMonthly]}                     \\
                Firms Number              & \py{stat.loc[wslbl,stc.firmsNo]}                    & \py{stat.loc[bslbl,stc.firmsNo]}                           \\
                Production Firms          & \py{stat.loc[wslbl,stc.productionNo]}               & \py{stat.loc[bslbl,stc.productionNo]}                      \\
                Prdocution Firms \%       & \py{round(stat.loc[wslbl,stc.productionPct]*100,1)} & \py{round(stat.loc[bslbl,stc.productionPct]*100,1)}        \\
                \bottomrule
            \end{tabular}
        \end{center}
    \end{table}


    \section{Figures}

    \begin{figure}
        % \includegraphics[width=\linewidth]{../figs/firms.eps}
    \end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Document End %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
